/**
 * SVGAnimation
 * This file contains the introduction section
 *
 * Author:
 * Markus Bergh, 2015
 */

define([
  'jquery',
  'snapsvg',
  'waypoints',
  'pubsub'
],

function($, Snap, Waypoint, CoreEvents) {

  'use strict';

  /**
   * Constructor
   */
  var SVGAnimation = function(elem, options) {
    this.elem = elem;
    this.$elem = $(elem);
    this.options = options;
    this.SVG_FILL_COLOR = '#fff';
    this.MOUSE_OFFSET_WAYPOINT = '85%';
  };

  /**
   * Prototype
   */
  SVGAnimation.prototype = {
    defaults: {
      $title: $('#me-myself-and-i'),
      $mouse_icon: $('#mouse-teasing-scroll'),
      paper_name: null,
      paper_mouse: null,
      svg: {
        firstname: [
          {
            code: 'M32.154,120.09v3.167H0v-3.167L14.615,114L58.218,0h2.192l41.167,117.897l13.884,2.192v3.167h-44.09v-3.167l12.18-1.949 l-12.91-35.564H30.936L18.756,114L32.154,120.09z M51.641,26.551L32.154,79.41h37.513L51.641,26.551z',
            letter: 'A'
          },
          {
            code: 'M193.045,66.013c0-11.042-4.263-16.564-12.789-16.564c-8.526,0-16.77,5.846-24.725,17.539v51.884l9.013,1.218v3.167h-34.59v-3.167l10.474-1.218V49.936l-10.474-1.462v-2.923h25.577v16.077c8.119-11.692,17.862-17.538,29.231-17.538c7.144,0,12.827,1.827,17.051,5.48c4.221,3.654,6.333,8.975,6.333,15.955v53.346l10.23,1.218v3.167h-34.346v-3.167l9.013-1.218V66.013z',
            letter: 'N'
          },
          {
            code: 'M302.535,123.256v-15.59c-5.359,11.369-13.603,17.051-24.724,17.051c-11.125,0-19.974-3.692-26.551-11.083 c-6.577-7.388-9.865-17.173-9.865-29.353c0-12.18,3.288-21.923,9.865-29.231s15.426-10.961,26.551-10.961 c11.122,0,19.365,5.766,24.724,17.295V7.551l-10.474-1.218V3.167h25.577v115.705l10.474,1.218v3.167H302.535z M257.958,76.974 v14.859c0,19.487,6.9,29.23,20.705,29.23c6.657,0,12.259-2.759,16.808-8.282c4.544-5.519,6.9-12.096,7.064-19.731V76 c-0.164-7.795-2.52-14.452-7.064-19.975c-4.548-5.519-10.151-8.282-16.808-8.282C264.859,47.744,257.958,57.487,257.958,76.974z',
            letter: 'D'
          },
          {
            code: 'M349.183,123.256v-3.167l10.474-1.218V49.936l-10.474-1.462v-2.923h25.577V57c6.333-8.605,13.478-12.91,21.436-12.91 c3.734,0,7.064,0.974,9.987,2.923c2.923,1.949,4.385,4.506,4.385,7.673c0,3.167-0.895,5.603-2.68,7.308 c-1.789,1.705-4.183,2.558-7.186,2.558c-3.007,0-5.401-1.218-7.186-3.654c1.134-1.461,1.663-3.003,1.583-4.628 c-0.083-1.621-0.692-3.003-1.827-4.141c-1.138-1.134-2.68-1.705-4.628-1.705c-3.897,0-8.525,4.061-13.885,12.18v56.269l11.936,1.218 v3.167H349.183z',
            letter: 'R'
          },
          {
            code: 'M489.367,115.461c5.195-3.897,8.441-8.929,9.743-15.103h3.654c-1.462,7.471-5.036,13.397-10.719,17.782 c-5.686,4.384-12.666,6.577-20.948,6.577c-11.369,0-20.869-3.734-28.5-11.205c-7.471-7.308-11.205-16.929-11.205-28.865 s3.654-21.68,10.961-29.231s16.199-11.327,26.673-11.327s18.756,3.128,24.846,9.378c6.09,6.253,9.215,14.09,9.378,23.506h-55.294 v14.859c0,8.933,1.949,16.077,5.846,21.436c4.221,5.523,9.903,8.282,17.051,8.282C477.998,121.551,484.168,119.522,489.367,115.461z M469.88,47.5c-6.661,0-11.856,2.314-15.59,6.942c-3.738,4.628-5.766,10.923-6.09,18.878h38.487 C486.688,56.109,481.085,47.5,469.88,47.5z',
            letter: 'E'
          },
          {
            code: 'M577.668,108.397c-2.6,5.199-6.333,9.218-11.205,12.058s-10.437,4.263-16.686,4.263c-6.254,0-11.369-1.663-15.347-4.994 c-3.981-3.326-5.968-7.917-5.968-13.763s1.218-10.474,3.654-13.885c6.82-8.929,20.218-13.397,40.191-13.397h5.359V64.064 c0-11.042-5.035-16.564-15.103-16.564c-4.548,0-8.244,1.058-11.083,3.167c-2.844,2.112-4.263,4.548-4.263,7.308 c0,2.763,1.298,4.548,3.897,5.359c0,2.599-0.937,4.833-2.802,6.699c-1.869,1.869-4.103,2.801-6.698,2.801 c-2.437,0-4.591-0.933-6.455-2.801c-1.869-1.865-2.802-4.179-2.802-6.942c0-5.195,2.923-9.66,8.77-13.397 c5.846-3.734,12.99-5.603,21.436-5.603c20.298,0,30.365,7.715,30.205,23.141v46.039c0,4.548,1.865,6.821,5.603,6.821 c3.734,0,5.603-2.192,5.603-6.577h3.167c0,3.41-1.139,6.132-3.41,8.16c-2.276,2.029-5.603,3.045-9.987,3.045 s-8.122-1.34-11.205-4.019C579.453,118.019,577.828,113.92,577.668,108.397z M577.668,97.679V82.333h-5.359 c-7.794,0-14.333,1.869-19.608,5.603c-5.279,3.737-7.917,9.34-7.917,16.808c0,4.061,1.097,7.228,3.289,9.5 c2.192,2.276,5.48,3.41,9.865,3.41s8.605-1.785,12.666-5.359C574.661,108.725,577.018,103.853,577.668,97.679z',
            letter: 'A'
          },
          {
            code: 'M642.097,109.859c0,7.958,5.359,11.936,16.077,11.936c5.519,0,10.311-1.378,14.372-4.141c4.058-2.759,6.09-6.09,6.09-9.987 s-1.382-6.778-4.142-8.647c-2.763-1.865-7.308-3.855-13.641-5.968l-19.487-6.09c-8.933-2.596-13.397-9.256-13.397-19.974 c0-6.493,2.596-11.936,7.795-16.321c5.195-4.384,11.936-6.577,20.218-6.577s14.775,1.423,19.487,4.263 c4.708,2.843,7.064,6.619,7.064,11.327c0,2.436-0.814,4.548-2.437,6.333c-1.625,1.789-3.573,2.68-5.846,2.68 c-2.276,0-4.104-0.567-5.48-1.705c-1.382-1.134-2.071-2.68-2.071-4.628c1.949-1.461,3.003-3.41,3.167-5.846 c0-6.333-4.548-9.5-13.641-9.5c-6.497,0-11.654,1.302-15.469,3.897c-3.817,2.6-5.724,5.603-5.724,9.013 c0,3.411,0.688,5.846,2.07,7.308c1.378,1.462,4.02,2.843,7.917,4.141l23.871,7.308c5.52,1.789,9.622,4.469,12.302,8.039 c2.68,3.574,4.02,8.404,4.02,14.494s-2.314,11.533-6.942,16.321c-4.629,4.792-11.654,7.186-21.071,7.186 c-20.302,0-30.448-5.519-30.448-16.564c0-3.083,0.891-5.641,2.68-7.673c1.785-2.028,3.897-3.044,6.333-3.044 c4.708,0,7.711,2.112,9.013,6.333C642.987,105.718,642.097,107.75,642.097,109.859z',
            letter: 'S'
          }
        ],
        lastname: [
          {
            code: 'M858.644,90.859c0,11.045-4.02,19.206-12.058,24.481c-8.039,5.279-18.879,7.917-32.52,7.917h-52.859v-3.167l13.642-2.192 V8.525l-13.642-2.192V3.167h45.795c15.914,0,27.24,2.234,33.981,6.699c6.736,4.468,10.108,11.571,10.108,21.314 c0,14.456-9.176,23.628-27.525,27.526v0.974C846.951,62.766,858.644,73.161,858.644,90.859z M807.002,7.064h-15.589v51.397h16.563 c7.955,0,14.087-2.272,18.392-6.82c4.301-4.544,6.455-10.962,6.455-19.244v-0.975C832.982,15.186,824.377,7.064,807.002,7.064z M814.066,62.359h-22.653v57.244h22.653c8.442,0,15.061-2.474,19.853-7.43c4.788-4.952,7.186-12.058,7.186-21.314v-1.461 c0-9.093-2.355-15.872-7.063-20.34C829.329,64.593,822.672,62.359,814.066,62.359z',
            letter: 'B'
          },
          {
            code: 'M944.508,115.461c5.195-3.897,8.441-8.929,9.743-15.103h3.654c-1.462,7.471-5.036,13.397-10.719,17.782 c-5.686,4.384-12.666,6.577-20.948,6.577c-11.369,0-20.869-3.734-28.5-11.205c-7.472-7.308-11.205-16.929-11.205-28.865 s3.653-21.68,10.962-29.231c7.308-7.551,16.198-11.327,26.673-11.327c10.474,0,18.756,3.128,24.846,9.378 c6.09,6.253,9.215,14.09,9.378,23.506h-55.294v14.859c0,8.933,1.948,16.077,5.846,21.436c4.221,5.523,9.903,8.282,17.052,8.282 C933.139,121.551,939.309,119.522,944.508,115.461z M925.021,47.5c-6.661,0-11.856,2.314-15.59,6.942 c-3.737,4.628-5.767,10.923-6.09,18.878h38.487C941.828,56.109,936.226,47.5,925.021,47.5z',
            letter: 'E'
          },
          {
            code: 'M981.898,123.256v-3.167l10.475-1.218V49.936l-10.475-1.462v-2.923h25.577V57c6.333-8.605,13.478-12.91,21.436-12.91 c3.733,0,7.064,0.974,9.987,2.923s4.385,4.506,4.385,7.673c0,3.167-0.895,5.603-2.68,7.308c-1.789,1.705-4.183,2.558-7.186,2.558 c-3.007,0-5.401-1.218-7.187-3.654c1.135-1.461,1.663-3.003,1.584-4.628c-0.084-1.621-0.693-3.003-1.827-4.141 c-1.138-1.134-2.68-1.705-4.628-1.705c-3.897,0-8.526,4.061-13.885,12.18v56.269l11.936,1.218v3.167H981.898z',
            letter: 'R'
          },
          {
            code: 'M1082.378,97.923c-6.661,0.487-9.987,3.087-9.987,7.795c0,2.276,1.298,4.02,3.897,5.237 c2.596,1.218,5.846,1.827,9.743,1.827h24.603c7.955,0,14.007,1.583,18.147,4.75c4.142,3.167,6.212,8.404,6.212,15.711 c0,9.58-3.289,17.618-9.865,24.115c-6.577,6.493-15.955,9.744-28.135,9.744s-21.356-1.911-27.526-5.725 c-6.173-3.817-9.256-8.891-9.256-15.224c0-3.738,1.298-6.984,3.897-9.744c2.596-2.763,6.17-4.141,10.718-4.141 c0.811,0,2.68,0.244,5.603,0.731c-3.087,3.247-4.628,7.346-4.628,12.301c0,4.952,1.743,9.336,5.237,13.154 c3.49,3.813,9.621,5.724,18.391,5.724s16.199-2.52,22.288-7.551c6.09-5.035,9.135-10.718,9.135-17.051 c0-4.384-1.138-7.513-3.41-9.378c-2.275-1.869-6.333-2.801-12.18-2.801h-29.23c-14.128,0-21.192-4.952-21.192-14.859 c0-4.544,1.218-8.24,3.654-11.083c2.436-2.839,5.762-4.75,9.987-5.725c-7.795-5.195-11.692-12.583-11.692-22.167 c0-9.58,2.881-16.888,8.647-21.923c5.762-5.032,12.91-7.551,21.436-7.551s15.548,2.192,21.07,6.577 c3.897-0.16,6.779-1.012,8.647-2.558c1.865-1.542,2.802-3.289,2.802-5.237s-0.487-3.41-1.462-4.384 c-0.975-0.975-2.112-1.462-3.41-1.462c0-2.596,0.891-4.75,2.68-6.455c1.785-1.705,3.978-2.558,6.577-2.558 c2.596,0,4.788,0.814,6.576,2.436c1.785,1.625,2.68,4.225,2.68,7.795c0,3.574-1.747,6.862-5.237,9.865 c-3.494,3.007-9.135,4.75-16.93,5.237c4.872,5.035,7.267,11.654,7.187,19.853c-0.084,8.202-3.007,14.859-8.77,19.974 c-5.766,5.116-13.115,7.673-22.045,7.673C1091.55,100.846,1086.599,99.872,1082.378,97.923z M1113.801,76v-7.308 c0-14.616-5.48-21.923-16.442-21.923s-16.442,7.308-16.442,21.923V76c0,6.984,1.34,12.423,4.02,16.32 c2.679,3.897,6.778,5.846,12.301,5.846c5.519,0,9.66-1.949,12.423-5.846C1112.419,88.423,1113.801,82.984,1113.801,76z',
            letter: 'G'
          },{
            code: 'M1218.907,66.013c0-11.042-4.263-16.564-12.788-16.564c-8.526,0-16.77,5.846-24.725,17.539v51.884l9.013,1.218v3.167 h-34.346v-3.167l10.23-1.218V7.551l-10.23-1.218V3.167h25.333v58.461c8.118-11.692,17.862-17.538,29.23-17.538 c7.145,0,12.827,1.827,17.052,5.48c4.221,3.654,6.333,8.975,6.333,15.955v53.346l10.475,1.218v3.167h-34.59v-3.167l9.013-1.218 V66.013z',
            letter: 'H'
          }
        ],
        mouse: {
          outline: {
            code: 'M13.781,2C19.14,2,23,5.86,23,11.219v16.562C23,33.14,19.14,38,13.781,38h-1.562C6.86,38,2,33.14,2,27.781V11.219 C2,5.86,6.86,2,12.219,2H14 M13.781,0h-1.562C5.747,0,0,4.747,0,11.219v16.562C0,34.253,5.747,40,12.219,40h1.562 C20.253,40,25,34.253,25,27.781V11.219C25,4.747,20.253,0,13.781,0L13.781,0z'
          },
          button: {
            code: 'M15,14.5c0,1.381-1.119,2.5-2.5,2.5l0,0c-1.381,0-2.5-1.119-2.5-2.5v-3c0-1.381,1.119-2.5,2.5-2.5l0,0 c1.381,0,2.5,1.119,2.5,2.5V14.5z'
          }
        }
      },
      letters: [],
      mouse_path: {
        outline: null,
        button: null
      }
    },

    init: function() {
      var self = this;

      // Introduce defaults that can be extended either globally or using an object literal.
      self.config = $.extend({}, this.defaults, this.options);

      // Create svg
      self.createName();
      self.createMouse();

      // Set sizes
      self.setSizeName();
      self.setSizeMouse();
      self.setSize();

      // Animate name stroke
      self.animateNameStroke();

      // Animate mouse
      self.animateMouse();

      // Set events
      self.setListeners();
    },

    setListeners: function() {
      var self = this;

      new Waypoint({
        element: $('#mouse-teasing-scroll'),
        handler: function(direction) {
          if(direction === 'down') {
            self.config.$mouse_icon.attr('class', 'mouse-teasing-scroll is-hidden');
          } else {
            self.config.$mouse_icon.attr('class', 'mouse-teasing-scroll');
          }
        },
        offset: self.MOUSE_OFFSET_WAYPOINT
      });

      CoreEvents.subscribe('/app/resize', function() {
        self.setSize();
      });


      return self;
    },

    setSize: function() {
      var self = this;

      self.config.$title.attr({
        width: $(window).width()
      });

      return self;
    },

    createName: function() {
      var self = this;

      self.config.paper_name = Snap('#me-myself-and-i');
      $(self.config.paper_name).css({
        display: 'block'
      });

      // First name
      for(var index in self.config.svg.firstname) {
        var letterObj = self.config.svg.firstname[index];

        var svgObj = self.config.paper_name.path(letterObj.code);
        svgObj.attr({
          fill: self.SVG_FILL_COLOR,
          stroke: self.SVG_FILL_COLOR,
          fillOpacity: 0.0,
          strokeWidth: 2
        });

        self.config.letters.push(svgObj);
      }

      // Last name
      for(var index2 in self.config.svg.lastname) {
        var letterObj2 = self.config.svg.lastname[index2];

        var svgObj2 = self.config.paper_name.path(letterObj2.code);
        svgObj2.attr({
          fill: self.SVG_FILL_COLOR,
          stroke: self.SVG_FILL_COLOR,
          fillOpacity: 0.0,
          strokeWidth: 2
        });

        self.config.letters.push(svgObj2);
      }

      return self;
    },

    createMouse: function() {
      var self = this;

      // Mouse
      self.config.paper_mouse = Snap('#mouse-teasing-scroll');

      // Outline
      self.config.mouse_path.outline = self.config.paper_mouse.path(
        self.config.svg.mouse.outline.code
      ).attr({
        fill: self.SVG_FILL_COLOR
      });

      // Button
      self.config.mouse_path.button = self.config.paper_mouse.path(
        self.config.svg.mouse.button.code
      ).attr({
        fill: self.SVG_FILL_COLOR
      });

      return self;
    },

    setSizeName: function() {
      var self = this;

      var bbox = self.config.paper_name.getBBox();

      self.config.paper_name.attr({
        width: Math.ceil(bbox.width),
        height: Math.ceil(bbox.height)
      });

      return self;
    },

    setSizeMouse: function() {
      var self = this;

      var bbox = self.config.paper_mouse.getBBox();

      self.config.paper_mouse.attr({
        width: Math.ceil(bbox.width),
        height: Math.ceil(bbox.height)
      });

      return self;
    },

    animateNameStroke: function() {
      var self = this;

      self.config.letters.forEach(function(svgObj) {
        var length = svgObj.getTotalLength();

        svgObj.attr({
          strokeDasharray: length + ' ' + length
        });

        Snap.animate(length, 0, function(val) {
          svgObj.attr({
            strokeDashoffset: val
          });
        }, 1200, mina.easeInOutQuad, function() {
          self.handleNameAnimationStrokeComplete();
        });
      });

      return self;
    },

    animateNameFill: function() {
      var self = this;

      self.config.letters.forEach(function(svgObj) {
        svgObj.animate({
          fillOpacity: 1.0
        }, 1000, mina.easeOutSine);
      });

      return self;
    },

    animateMouse: function() {
      var self = this;

      self.config.mouse_path.button.transform('t0,0');

      self.config.mouse_path.button.animate({
        transform: 't0,5'
      }, 1500, mina.easeInOutQuad, function() {
        self.config.mouse_path.button.animate({
          transform: 't0,0'
        }, 1500, mina.easeInOutQuad, function() {
          self.animateMouse();
        });
      });

      return self;
    },

    handleNameAnimationStrokeComplete: function() {
      var self = this;

      self.animateNameFill();

      return self;
    }
  };

  /**
   * Defaults
   */
  SVGAnimation.defaults = SVGAnimation.prototype.defaluts;

  $.fn.SVGAnimation = function(options) {
    return this.each(function() {
      new SVGAnimation(this, options).init();
    });
  };

  return SVGAnimation;
});
